import{_ as e,o as r,c as a,aj as d}from"./chunks/framework.DpVzuYkC.js";const k=JSON.parse('{"title":"Derper","description":"","frontmatter":{},"headers":[],"relativePath":"derper/index.md","filePath":"derper/README.md"}'),s={name:"derper/index.md"};function i(l,t,n,h,o,p){return r(),a("div",null,[...t[0]||(t[0]=[d('<h1 id="derper" tabindex="-1">Derper <a class="header-anchor" href="#derper" aria-label="Permalink to “Derper”">​</a></h1><p><a href="https://tailscale.com/kb/1232/derp-servers" target="_blank" rel="noreferrer">Office Web</a> - <a href="https://github.com/tailscale/tailscale/tree/main/cmd/derper" target="_blank" rel="noreferrer">Source</a> - <a href="https://github.com/kaaanata/derper-docker/pkgs/container/derper" target="_blank" rel="noreferrer">Docker Image</a> - <a href="https://github.com/kaaanata/derper-docker" target="_blank" rel="noreferrer">Document</a></p><hr><blockquote><p><a href="https://tailscale.com/kb/1232/derp-servers" target="_blank" rel="noreferrer">Derper</a> （指定数据包加密中继）服务器负责管理设备连接和网络地址转换（NAT）穿越。它们主要有两个作用：</p><ul><li>协商并建立尾网（tailnet）设备之间的连接（直接连接或中继连接）。</li><li>当无法建立直接连接且对等中继服务器不可用时，作为备用选项。</li></ul></blockquote><hr><blockquote><p>必需：将环境变量 <code>DERP_DOMAIN</code> 设置为你的域名</p></blockquote><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DERP_DOMAIN=derper.your-domain.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 80:80</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 443:443</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 3478:3478/udp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ghcr.io/kaaanata/derper</span></span></code></pre></div><table tabindex="0"><thead><tr><th>环境变量</th><th>是否必需</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td>DERP_DOMAIN</td><td>是</td><td>Derper 服务器主机名</td><td>your-hostname.com</td></tr><tr><td>DERP_CERT_DIR</td><td>否</td><td>存储 Let&#39;s Encrypt 证书的目录（如果地址端口是 :443）</td><td>/app/certs</td></tr><tr><td>DERP_CERT_MODE</td><td>否</td><td>获取证书的模式。可能的选项：manual（手动）, letsencrypt（Let&#39;s Encrypt 自动获取）</td><td>letsencrypt</td></tr><tr><td>DERP_ADDR</td><td>否</td><td>监听服务器地址。中转端口</td><td>:443</td></tr><tr><td>DERP_STUN</td><td>否</td><td>同时运行一个 STUN 服务器</td><td>true</td></tr><tr><td>DERP_STUN_PORT</td><td>否</td><td>用于提供 STUN 服务的 UDP 端口。<strong>STUN 打洞端口</strong></td><td>3478</td></tr><tr><td>DERP_HTTP_PORT</td><td>否</td><td>用于提供 HTTP 服务的端口。设置为 -1 可禁用</td><td>80</td></tr><tr><td>DERP_VERIFY_CLIENTS</td><td>否</td><td>通过本地运行的 Tailscale 实例验证连接到该 DERP 服务器的客户端。<strong>验证客户端身份，防止白嫖</strong></td><td>false</td></tr><tr><td>DERP_VERIFY_CLIENT_URL</td><td>否</td><td>如果非空，这是一个准入控制器 URL，用于允许客户端连接</td><td>&quot;&quot;</td></tr></tbody></table><h1 id="使用方法" tabindex="-1">使用方法 <a class="header-anchor" href="#使用方法" aria-label="Permalink to “使用方法”">​</a></h1><p>完整的 Derper 设置官方文档：<a href="https://tailscale.com/kb/1118/custom-derp-servers/" target="_blank" rel="noreferrer">https://tailscale.com/kb/1118/custom-derp-servers/</a></p><h2 id="客户端验证" tabindex="-1">客户端验证 <a class="header-anchor" href="#客户端验证" aria-label="Permalink to “客户端验证”">​</a></h2><p>为了使用 <code>DERP_VERIFY_CLIENTS</code>，容器需要访问 Tailscale 的本地 API，通常可通过 <code>/var/run/tailscale/tailscaled.sock</code> 进行访问。如果你在 Linux 裸机上运行 Tailscale，将以下内容添加到 <code>docker run</code> 命令中通常就足够了：<code>-v /var/run/tailscale/tailscaled.sock:/var/run/tailscale/tailscaled.sock</code></p>',12)])])}const _=e(s,[["render",i]]);export{k as __pageData,_ as default};
