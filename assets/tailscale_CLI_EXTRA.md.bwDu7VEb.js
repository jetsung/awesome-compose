import{_ as i,o as a,c as e,aj as l}from"./chunks/framework.DpVzuYkC.js";const r=JSON.parse('{"title":"tailscale funnel command","description":"","frontmatter":{},"headers":[],"relativePath":"tailscale/CLI_EXTRA.md","filePath":"tailscale/CLI_EXTRA.md"}'),t={name:"tailscale/CLI_EXTRA.md"};function n(h,s,k,p,c,d){return a(),e("div",null,[...s[0]||(s[0]=[l(`<h1 id="tailscale-funnel-command" tabindex="-1"><a href="https://tailscale.com/kb/1311/tailscale-funnel" target="_blank" rel="noreferrer">tailscale funnel command</a> <a class="header-anchor" href="#tailscale-funnel-command" aria-label="Permalink to “tailscale funnel command”">​</a></h1><blockquote><p><strong>注意</strong>：Tailscale Funnel 和 Tailscale Serve 的 CLI 命令在 Tailscale 客户端 1.52 版本中已更改。如果您在之前的版本中使用过 Funnel 或 Serve，建议查看 CLI 文档。</p></blockquote><p><code>tailscale funnel</code> 允许您通过互联网共享本地服务。您也可以选择使用 <a href="https://tailscale.com/kb/1312/serve" target="_blank" rel="noreferrer">Tailscale Serve</a>，通过 <a href="https://tailscale.com/kb/1242/tailscale-serve" target="_blank" rel="noreferrer"><code>tailscale serve</code></a> 命令将共享限制在您的 tailnet 内。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funnel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [flags] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">target</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>子命令：</p><ul><li><a href="#get-the-status"><code>status</code></a> 获取状态</li><li><a href="#reset-tailscale-funnel"><code>reset</code></a> 重置配置</li></ul><p>要探索各种用例和示例，请参阅 <a href="https://tailscale.com/kb/1247/funnel-examples" target="_blank" rel="noreferrer">Tailscale Funnel 示例</a>。</p><h2 id="funnel-命令标志" tabindex="-1">Funnel 命令标志 <a class="header-anchor" href="#funnel-命令标志" aria-label="Permalink to “Funnel 命令标志”">​</a></h2><p>可用标志：</p><ul><li><code>--bg</code> 确定命令是否应作为后台进程运行。</li><li><code>--https=&lt;port&gt;</code> 在指定端口暴露 HTTPS 服务器（默认）。</li><li><code>--proxy-protocol=&lt;version&gt;</code> 用于 TCP 转发的 PROXY 协议版本（1 或 2）。</li><li><code>--set-path=&lt;path&gt;</code> 将指定路径附加到访问底层服务的基础 URL。</li><li><code>--tcp=&lt;port&gt;</code> 在指定端口暴露 TCP 转发器以转发 TCP 数据包。</li><li><code>--tls-terminated-tcp=&lt;port&gt;</code> 在指定端口暴露 TLS 终止的 TCP 转发器以转发 TCP 数据包。</li><li><code>--yes</code> 无需交互式提示即可更新。</li></ul><p><code>tailscale funnel</code> 命令接受一个目标，该目标可以是文件、目录、文本，或最常见的是本地计算机上运行的服务的位置。本地服务的位置可以表示为端口号（例如 <code>3000</code>）、部分 URL（例如 <code>localhost:3000</code>）或包含路径的完整 URL（例如 <code>tls-terminated-tcp://localhost:3000/foo</code>）。</p><h2 id="使用-https-和-http-服务器" tabindex="-1">使用 HTTPS 和 HTTP 服务器 <a class="header-anchor" href="#使用-https-和-http-服务器" aria-label="Permalink to “使用 HTTPS 和 HTTP 服务器”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funnel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --https=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">targe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [off]</span></span></code></pre></div><p><code>funnel</code> 提供一个 HTTPS 服务器，有几种模式：反向代理、文件服务器和静态文本服务器。HTTPS 流量使用自动配置的 TLS 证书进行保护。默认情况下，终止由您节点的 Tailscale 守护进程本身完成。</p><ul><li><p><code>--https=&lt;port&gt;</code> 指定要监听的端口。对于 Funnel，您必须使用允许的端口之一：<code>443</code>、<code>8443</code> 或 <code>10000</code>。</p></li><li><p><code>--set-path</code> 是一个斜杠分隔的 URL 路径。根级挂载点将只是 <code>/</code>，并且将通过向 <code>https://my-node.example.ts.net/</code> 发出请求来匹配。有关这些路径模式如何匹配的更多信息，请参阅 Go <a href="https://pkg.go.dev/net/http#ServeMux" target="_blank" rel="noreferrer">ServeMux</a> 文档。我们的挂载点行为类似。</p></li><li><p><code>&lt;target&gt;</code> Funnel 提供 4 个内容服务选项：HTTP 反向代理、文件、目录和静态文本。反向代理允许您将请求转发到本地 HTTP Web 服务器。提供本地文件路径可以提供服务文件或文件目录的能力。静态文本服务主要用于调试目的，并提供静态响应。</p><ul><li><p><strong>反向代理</strong></p><p>要作为本地后端的反向代理，请提供 <code>&lt;target&gt;</code> 参数的位置。本地服务的位置可以表示为端口号（例如 <code>3000</code>）、部分 URL（例如 <code>localhost:3000</code>）或包含路径的完整 URL（例如 <code>tls-terminated-tcp://localhost:3000/foo</code>）。请注意，目前只有 <code>http://127.0.0.1</code> 支持代理。</p><p>示例：<code>tailscale funnel localhost:3000</code></p></li><li><p><strong>文件服务器</strong></p><p>提供您希望服务的文件或文件目录的完整绝对路径。如果指定了目录，这将呈现一个简单的目录列表，其中包含指向文件和子目录的链接。</p><p>示例：<code>tailscale funnel /home/alice/blog/index.html</code></p><p>由于 macOS 应用沙盒限制，此选项仅在使用 Tailscale 的<a href="https://tailscale.com/kb/1065/macos-variants" target="_blank" rel="noreferrer">开源版本</a>时可用。如果您通过 Mac App Store 或作为独立版本系统扩展在 macOS 上安装了 Tailscale，您可以使用 Funnel 共享端口，但不能共享文件或目录。</p></li><li><p><strong>静态文本服务器</strong></p><p>将 <code>text:&lt;value&gt;</code> 指定为 <code>&lt;target&gt;</code> 会配置一个简单的静态纯文本服务器。</p><p>示例：<code>tailscale funnel text:&quot;Hello, world!&quot;</code></p></li></ul></li></ul><h2 id="使用-proxy-协议" tabindex="-1">使用 PROXY 协议 <a class="header-anchor" href="#使用-proxy-协议" aria-label="Permalink to “使用 PROXY 协议”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funnel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --proxy-protocol=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">targe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><blockquote><p><strong>注意</strong>：对于大多数情况，用户可能会使用版本 <code>2</code>。</p></blockquote><p><a href="https://www.haproxy.com/blog/use-the-proxy-protocol-to-preserve-a-clients-ip-address" target="_blank" rel="noreferrer">PROXY 协议</a>是一种最小的网络协议，用于保留有关代理连接的信息（通常是源 IP 地址），通过代理或负载均衡器传递到后端目标。这使您使用 Funnel 公开的服务能够确定连接客户端的原始 IP 地址和端口。</p><p>例如：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funnel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --proxy-protocol=2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tls-terminated-tcp=443</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp://127.0.0.1:9899</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Available</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> internet:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp://funnel-test.example.ts.net:443</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (TLS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">terminated,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PROXY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> protocol</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp://100.101.102.103:443</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp://[fd7a:115c:a1e0::1111:2222]:443</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">tcp://127.0.0.1:9899</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Press</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Ctrl+C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exit.</span></span></code></pre></div><p>后端（运行在 <code>localhost:9899</code>）然后通过 PROXY 协议获取原始源 IP 和端口。</p><h2 id="使用-tcp-转发器" tabindex="-1">使用 TCP 转发器 <a class="header-anchor" href="#使用-tcp-转发器" aria-label="Permalink to “使用 TCP 转发器”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funnel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tcp=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp://localhost:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">local-por</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [off]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funnel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tls-terminated-tcp=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp://localhost:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">local-por</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [off]</span></span></code></pre></div><p><code>funnel</code> 命令提供一个 TCP 转发器，将 TLS 终止的 TCP 数据包转发到本地 TCP 服务器，如 Caddy 或其他基于 TCP 的协议，如 SSH 或 RDP。默认情况下，TCP 转发器转发原始数据包。</p><ul><li><p><code>--tcp=&lt;port&gt;</code> 在指定端口设置原始 TCP 转发器。对于 Funnel，您必须使用允许的端口之一：<code>443</code>、<code>8443</code> 或 <code>10000</code>。</p></li><li><p><code>--tls-terminated-tcp=&lt;port&gt;</code> 在指定端口设置 TLS 终止的 TCP 转发器。对于 Funnel，您必须使用允许的端口之一：<code>443</code>、<code>8443</code> 或 <code>10000</code>。</p></li></ul><h2 id="使用有效证书" tabindex="-1">使用有效证书 <a class="header-anchor" href="#使用有效证书" aria-label="Permalink to “使用有效证书”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funnel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https:targe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>如果您有有效证书，请在 <code>&lt;target&gt;</code> 参数中使用 <code>https</code>。</p><p>示例：<code>tailscale funnel https://localhost:8443</code></p><h2 id="忽略无效和自签名证书检查" tabindex="-1">忽略无效和自签名证书检查 <a class="header-anchor" href="#忽略无效和自签名证书检查" aria-label="Permalink to “忽略无效和自签名证书检查”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funnel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https+insecure:targe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>如果您使用自签名或其他无效证书运行本地 HTTPS Web 服务器，您可以为 <code>tailscale funnel</code> 命令指定 <code>https+insecure</code> 作为特殊的伪协议。</p><p>示例：<code>tailscale funnel https+insecure://localhost:8443</code></p><h2 id="获取状态" tabindex="-1">获取状态 <a class="header-anchor" href="#获取状态" aria-label="Permalink to “获取状态”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funnel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [--json]</span></span></code></pre></div><p>要获取服务器的状态，您可以使用 <code>status</code> 子命令。这将列出当前在您的节点上运行的所有服务器。</p><ul><li><code>--json</code> 如果您希望以 JSON 格式获取状态，可以提供 <code>--json</code> 参数。</li></ul><p>示例：<code>tailscale funnel status --json</code></p><h2 id="重置-tailscale-funnel" tabindex="-1">重置 Tailscale Funnel <a class="header-anchor" href="#重置-tailscale-funnel" aria-label="Permalink to “重置 Tailscale Funnel”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funnel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span></span></code></pre></div><p>要清除当前的 <code>tailscale funnel</code> 配置，请使用 <code>reset</code> 子命令。</p><h2 id="关闭-tailscale-funnel" tabindex="-1">关闭 Tailscale Funnel <a class="header-anchor" href="#关闭-tailscale-funnel" aria-label="Permalink to “关闭 Tailscale Funnel”">​</a></h2><ul><li><code>[off]</code> 要关闭 <code>tailscale funnel</code> 命令，您可以在用于打开它的命令末尾添加 <code>off</code>。这将从活动服务器列表中删除服务器。在 <code>off</code> 命令中，<code>&lt;target&gt;</code> 参数是可选的，但所有原始标志都是必需的。</li></ul><p>如果此命令打开了服务器：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funnel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --https=443</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/alice/blog/index.html</span></span></code></pre></div><p>您可以通过运行以下命令将其关闭：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funnel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --https=443</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/alice/blog/index.html</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> off</span></span></code></pre></div><p>您可以省略 <code>&lt;target&gt;</code> 参数，因此这两个命令是等效的：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funnel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --https=443</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set-path=/foo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/alice/blog/index.html</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> off</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funnel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --https=443</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set-path=/foo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> off</span></span></code></pre></div><h2 id="重启和重新启动的影响" tabindex="-1">重启和重新启动的影响 <a class="header-anchor" href="#重启和重新启动的影响" aria-label="Permalink to “重启和重新启动的影响”">​</a></h2><p>如果您使用 <a href="#funnel-command-flags"><code>-bg</code></a> 标志运行 <code>tailscale funnel</code> 命令，它将在后台持续运行，直到您<a href="#turn-tailscale-funnel-off">将其关闭</a>。当您重新启动设备或使用 <a href="https://tailscale.com/kb/1080/cli#down" target="_blank" rel="noreferrer"><code>tailscale down</code></a> 和 <a href="https://tailscale.com/kb/1080/cli#up" target="_blank" rel="noreferrer"><code>tailscale up</code></a> 从命令行重新启动 Tailscale 时，Funnel 将自动恢复共享。</p><p>如果您不使用 <code>-bg</code> 标志运行 <code>tailscale funnel</code> 命令，然后重新启动设备或从命令行重新启动 Tailscale，您必须手动重新启动 Funnel 以恢复共享。</p><hr><h1 id="tailscale-lock-command" tabindex="-1"><a href="https://tailscale.com/kb/1243/tailscale-lock" target="_blank" rel="noreferrer">tailscale lock command</a> <a class="header-anchor" href="#tailscale-lock-command" aria-label="Permalink to “tailscale lock command”">​</a></h1><p><code>tailscale lock</code> 管理您的 tailnet 的 <a href="https://tailscale.com/kb/1226/tailnet-lock" target="_blank" rel="noreferrer">Tailnet Lock</a>。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">subcomman</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [flags] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>子命令：</p><ul><li><a href="#lock-init"><code>init</code></a> 初始化 Tailnet Lock。</li><li><a href="#lock-status"><code>status</code></a> 输出 Tailnet Lock 的状态。</li><li><a href="#lock-add"><code>add</code></a> 向 Tailnet Lock 添加一个或多个受信任的签名密钥。</li><li><a href="#lock-remove"><code>remove</code></a> 从 Tailnet Lock 中移除一个或多个受信任的签名密钥。</li><li><a href="#lock-sign"><code>sign</code></a> 对节点密钥进行签名，并将签名传输到协调服务器。</li><li><a href="#lock-disable"><code>disable</code></a> 使用禁用密钥关闭 tailnet 的 Tailnet Lock。</li><li><a href="#lock-log"><code>log</code></a> 列出应用于 Tailnet Lock 的更改。</li><li><a href="#lock-local-disable"><code>local-disable</code></a> 仅为此节点禁用 Tailnet Lock。</li><li><a href="#lock-revoke-keys"><code>revoke-keys</code></a> 追溯撤销一个或多个 Tailnet Lock 密钥。</li></ul><p>不带子命令和参数运行 <code>Tailnet Lock</code> 等同于运行 <a href="#lock-status"><code>tailscale lock status</code></a>。</p><p>示例：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span></span></code></pre></div><p>示例输出：</p><div class="language-markup"><button title="Copy Code" class="copy"></button><span class="lang">markup</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Tailnet Lock is ENABLED.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>This node is accessible under Tailnet Lock.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>This node&#39;s tailnet-lock key: tlpub:1234abcdef</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Trusted signing keys:</span></span>
<span class="line"><span>	tlpub:1234abcdef	(us)</span></span></code></pre></div><h2 id="lock-init" tabindex="-1">lock init <a class="header-anchor" href="#lock-init" aria-label="Permalink to “lock init”">​</a></h2><p>为整个 tailnet 初始化 <a href="https://tailscale.com/kb/1226/tailnet-lock" target="_blank" rel="noreferrer">Tailnet Lock</a>。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [flags] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tlpub:trusted-key1 tlpub:trusted-key2 ...</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>可用标志：</p><ul><li><code>--confirm=false</code> 是否提示确认。如果为 <code>true</code>，则不会提示确认。</li><li><code>--gen-disablement-for-support</code> 生成一个额外的禁用密钥并将其传输给 Tailscale 支持。然后 Tailscale 支持可以使用它来禁用 Tailnet Lock。请注意，如果 Tailscale 支持禁用了 Tailnet Lock，它将保持禁用状态，Tailscale 支持无法重新启用它，因此这将被视为紧急恢复机制，而不是临时禁用 Tailnet Lock。</li><li><code>--gen-disablements &lt;N&gt;</code> 要生成的禁用密钥数量。如果未指定，默认为一个禁用密钥，这是初始化 Tailnet Lock 所需的最小数量。</li></ul><p>指定的 Tailnet Lock 密钥是初始受信任的密钥，用于对节点进行签名或对您的 Tailnet Lock 配置进行进一步更改。这些是 Tailnet Lock 公钥。您可以通过在该节点上运行 <code>tailscale lock</code> 然后复制该节点的 Tailnet Lock 密钥来识别您希望信任的节点的 Tailnet Lock 密钥。</p><p>您必须将运行 <code>tailscale lock init</code> 的节点的 Tailnet Lock 密钥指定为受信任的 Tailnet Lock 密钥之一。附加密钥列表必须用空格分隔。</p><blockquote><p><strong>注意</strong>：禁用密钥仅在您初始化 Tailnet Lock 时显示。请记下它们并将其安全地保存在安全的地方。</p></blockquote><p>示例：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --gen-disablements=3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --gen-disablement-for-support</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --confirm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tlpub:1234abcdef</span></span></code></pre></div><p>示例输出：</p><div class="language-markup"><button title="Copy Code" class="copy"></button><span class="lang">markup</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>You are initializing Tailnet Lock with the following trusted signing keys:</span></span>
<span class="line"><span> - tlpub:1234abcdef (25519 key)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>3 disablement secrets have been generated and are printed below. Take note of them now, they WILL NOT be shown again.</span></span>
<span class="line"><span>	disablement-secret:ABC1234</span></span>
<span class="line"><span>	disablement-secret:DEF5678</span></span>
<span class="line"><span>	disablement-secret:GHI9012</span></span>
<span class="line"><span>A disablement secret for Tailscale support has been generated and will be transmitted to Tailscale upon initialization.</span></span>
<span class="line"><span>Initialization complete.</span></span></code></pre></div><p>禁用密钥是禁用您的 Tailnet Lock 所需的长密码。有关更多信息，请参阅 <a href="#lock-disable"><code>tailscale lock disable</code></a> 命令。</p><p>禁用密钥的数量将是您为 <code>--gen-disablements</code> 指定的值。如果您设置了 <code>--gen-disablement-for-support</code>，您将收到一条关于为 Tailscale 支持生成禁用密钥的消息。</p><h2 id="lock-status" tabindex="-1">lock status <a class="header-anchor" href="#lock-status" aria-label="Permalink to “lock status”">​</a></h2><p>输出 Tailnet Lock 的状态。该命令显示 Tailnet Lock 是否已启用、节点的 Tailnet Lock 公钥的值，以及哪些节点被 Tailnet Lock 锁定且无法连接到其他节点。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [flags]</span></span></code></pre></div><p>可用标志：</p><ul><li><code>--json</code> 返回机器可读的 JSON 响应。</li></ul><p>示例：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span></span></code></pre></div><p>示例输出：</p><div class="language-markup"><button title="Copy Code" class="copy"></button><span class="lang">markup</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Tailnet Lock is ENABLED.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>This node is accessible under Tailnet Lock.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>This node&#39;s tailnet-lock key: tlpub:1234abcdef</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Trusted signing keys:</span></span>
<span class="line"><span>	tlpub:1234abcdef	(us)</span></span></code></pre></div><p>如果您运行 <code>tailscale lock status</code> 的节点没有可访问的密钥，输出将如下所示：</p><div class="language-markup"><button title="Copy Code" class="copy"></button><span class="lang">markup</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>This node is LOCKED OUT by tailnet-lock, and action is required to establish connectivity.</span></span>
<span class="line"><span>Run the following command on a node with a trusted key:</span></span>
<span class="line"><span>	tailscale lock sign nodekey:abcdef12 tlpub:11223344</span></span></code></pre></div><p>如果您的一个对等节点被锁定在您的 tailnet 之外，在受信任签名密钥列表之后，输出将如下所示：</p><div class="language-markup"><button title="Copy Code" class="copy"></button><span class="lang">markup</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span> The following nodes are locked out by Tailnet Lock and cannot connect to other nodes:</span></span>
<span class="line"><span>	bob.yak-bebop.ts.net.	100.111.222.33, fd7a:115c:a1e0:aabb:ccdd:eeff:0123:4567	n12345CNTRL</span></span></code></pre></div><h2 id="lock-add" tabindex="-1">lock add <a class="header-anchor" href="#lock-add" aria-label="Permalink to “lock add”">​</a></h2><p>向 Tailnet Lock 添加一个或多个受信任的签名密钥。</p><p>此命令需要从具有受信任 Tailnet Lock 密钥的节点运行。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">tlpub:trusted-key1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tlpub:trusted-key2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ..</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>指定的 Tailnet Lock 密钥是 Tailnet Lock 公钥。您可以通过在该节点上运行 <code>tailscale lock</code> 然后复制该节点的 Tailnet Lock 密钥来识别 Tailnet Lock 密钥。</p><p>附加密钥列表必须用空格分隔。</p><h2 id="lock-remove" tabindex="-1">lock remove <a class="header-anchor" href="#lock-remove" aria-label="Permalink to “lock remove”">​</a></h2><p>从 Tailnet Lock 中移除一个或多个受信任的签名密钥。</p><p>此命令需要从具有受信任 Tailnet Lock 密钥的节点运行。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remove</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [flags] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tlpub:trusted-key1 tlpub:trusted-key2 ...</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>可用标志：</p><ul><li><code>--re-sign</code> 重新签署因移除受信任签名密钥而失效的签名。默认为 true。</li></ul><p>指定的 Tailnet Lock 密钥是 Tailnet Lock 公钥。您可以通过在该节点上运行 <code>tailscale lock</code> 然后复制该节点的 Tailnet Lock 密钥来识别 Tailnet Lock 密钥。</p><p>附加密钥列表必须用空格分隔。</p><h2 id="lock-sign" tabindex="-1">lock sign <a class="header-anchor" href="#lock-sign" aria-label="Permalink to “lock sign”">​</a></h2><p>执行签名操作。<code>tailscale lock sign</code> 有两种签名模式：</p><ul><li>使用当前节点（运行命令的节点）上的 Tailnet Lock 密钥对节点密钥进行签名，并将签名传输到协调服务器。</li><li>对 <a href="https://tailscale.com/kb/1085/auth-keys" target="_blank" rel="noreferrer">预批准的 auth 密钥</a> 进行签名，以可用于在 <a href="https://tailscale.com/kb/1226/tailnet-lock" target="_blank" rel="noreferrer">Tailnet Lock</a> 下启动节点的形式打印。具体来说，它 <a href="https://tailscale.com/kb/1226/tailnet-lock#add-a-node-using-a-pre-signed-auth-key" target="_blank" rel="noreferrer">对 auth 密钥进行签名</a>，以便它可以验证新节点，而无需在将新节点添加到 tailnet 之前对其进行签名。每个签名的 auth 密钥，也称为包装的 auth 密钥，都嵌入了一个签名密钥，可以对一个新节点或多个节点进行签名，直到它被 <a href="#lock-remove">移除</a> 为止。</li></ul><p>对节点密钥进行签名对于为被 Tailnet Lock 锁定的节点建立连接是必需的。</p><p>如果任何密钥参数以 <code>file:</code> 开头，则从参数后缀中指定的路径的文件中检索密钥。</p><p>此命令需要从具有受信任 Tailnet Lock 密钥的节点运行。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sign</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node-ke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [&lt;rotation-key&gt;]</span></span></code></pre></div><p>或</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sign</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">auth-ke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>示例：</p><p>此示例演示了对节点密钥进行签名，可选择使用节点的 Tailnet Lock 密钥（<code>tlpub:trusted-key2</code>）来支持密钥轮换。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sign</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodekey:1abddef1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tlpub:trusted-key2</span></span></code></pre></div><p>此示例显示了对 auth 密钥进行签名。在此示例中，<code>$AUTH_KEY</code> 是一个环境变量，设置为 <a href="https://tailscale.com/kb/1085/auth-keys#types-of-auth-keys" target="_blank" rel="noreferrer">预批准</a> 的 auth 密钥，您 <a href="https://tailscale.com/kb/1085/auth-keys#generate-an-auth-key" target="_blank" rel="noreferrer">已经生成</a>。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sign</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $AUTH_KEY</span></span></code></pre></div><p>成功运行该命令的输出是一个签名的预批准 auth 密钥，然后您可以使用它来 <a href="https://tailscale.com/kb/1099/device-approval#pre-approve-devices-with-an-auth-key" target="_blank" rel="noreferrer">预批准设备</a> 在您的 tailnet 中。</p><blockquote><p><strong>警告</strong>：当您创建签名的 auth 密钥时，会为其创建一个新的受信任签名密钥，并将其添加到 <a href="https://tailscale.com/kb/1226/tailnet-lock#tailnet-key-authority" target="_blank" rel="noreferrer">tailnet 密钥授权机构</a>。签名密钥的私钥被编码在签名的 auth 密钥中。签名的 auth 密钥等同于 tailnet 中签名节点上的私钥，如果泄露，将对您的 tailnet 构成风险。即使 auth 密钥是单次使用的，签名密钥也会保持受信任状态，直到从 tailnet 密钥授权机构中移除。</p><p>出于安全最佳实践，我们不建议使用签名的 auth 密钥。</p></blockquote><h2 id="lock-disable" tabindex="-1">lock disable <a class="header-anchor" href="#lock-disable" aria-label="Permalink to “lock disable”">​</a></h2><p>使用指定的禁用密钥为整个 tailnet 禁用 Tailnet Lock。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">disablement-secre</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>禁用 Tailnet Lock 是一个与安全相关的操作——如果禁用过程缺乏授权检查，受损的控制平面可能会轻易地禁用 Tailnet Lock（及其所有保护）来攻击 tailnet。为避免这种情况，需要使用禁用密钥来全局禁用 Tailnet Lock。</p><p>禁用密钥是在启用 Tailnet Lock 的过程中生成的长密码，当您运行 <a href="#lock-init"><code>tailscale lock init</code></a> 时。每个禁用密钥的密钥派生函数（KDF）派生值由每个节点的 tailnet 密钥授权机构存储（因此 tailnet 中的每个节点都知道），但密钥本身在使用前保持机密。</p><p>当使用禁用密钥时，该密钥会分发到 tailnet 中的所有节点。然后，每个节点可以通过计算密钥的 KDF 值并将其与其 tailnet 密钥授权机构（TKA）中存储的 KDF 值进行比较来验证禁用操作的真实性。如果匹配，则节点可以确保禁用是真实的，并在本地禁用 Tailnet Lock。</p><p>一旦使用了指定的 <code>disablement-secret</code> 密钥，它就会被分发到 tailnet 中的所有节点，应被视为公开的。</p><p>如果重新启用 Tailnet Lock，将生成新的禁用密钥。</p><p>示例：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disablement-secret:ABC1234</span></span></code></pre></div><h2 id="lock-disablement-kdf" tabindex="-1">lock disablement-kdf <a class="header-anchor" href="#lock-disablement-kdf" aria-label="Permalink to “lock disablement-kdf”">​</a></h2><p>从禁用密钥计算禁用值。此命令仅供高级用户使用。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disablement-kdf</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hex-encoded-disablement-secre</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><h2 id="lock-log" tabindex="-1">lock log <a class="header-anchor" href="#lock-log" aria-label="Permalink to “lock log”">​</a></h2><p>列出应用于 Tailnet Lock 的更改。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [flags]</span></span></code></pre></div><p>可用标志：</p><ul><li><code>--json</code> 返回机器可读的 JSON 响应。</li><li><code>--limit</code> 要列出的最大更改数量。默认为 50。</li></ul><p>示例：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log</span></span></code></pre></div><p>示例输出：</p><div class="language-markup"><button title="Copy Code" class="copy"></button><span class="lang">markup</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>update 17310b8e655867d3973a72cd20bc7c21f81f7687b4e7911c285f2eb16df5df36 (checkpoint)</span></span>
<span class="line"><span>Disablement values:</span></span>
<span class="line"><span> - 1234abcd</span></span>
<span class="line"><span> - 9876aaaa</span></span>
<span class="line"><span> - c1d2e3f4</span></span>
<span class="line"><span> - 8f6e4d2c</span></span>
<span class="line"><span>Keys:</span></span>
<span class="line"><span>  Type: 25519</span></span>
<span class="line"><span>  KeyID: 1234abcdef</span></span>
<span class="line"><span>  Votes: 1</span></span></code></pre></div><h2 id="lock-local-disable" tabindex="-1">lock local-disable <a class="header-anchor" href="#lock-local-disable" aria-label="Permalink to “lock local-disable”">​</a></h2><p>仅为此节点禁用 Tailnet Lock。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> local-disable</span></span></code></pre></div><p>此命令仅禁用当前节点（运行命令的节点）的 Tailnet Lock。如果仅为此节点禁用 Tailnet Lock，该节点现在将接受来自被锁定节点的流量。这并不意味着该节点可以发送或接收来自 tailnet 中已签名其他节点的流量。</p><p>如果您遇到整个 tailnet 的 Tailnet Lock 重大问题，并且无法使用 <a href="#lock-disable"><code>tailscale lock disable</code></a> 禁用它（例如，如果您找不到您的禁用密钥），您可以在每个节点上运行 <code>tailscale lock local-disable</code>，以使您的 tailnet 实际上忽略 Tailnet Lock。</p><h2 id="lock-revoke-keys" tabindex="-1">lock revoke-keys <a class="header-anchor" href="#lock-revoke-keys" aria-label="Permalink to “lock revoke-keys”">​</a></h2><p>追溯撤销指定的 Tailnet Lock 密钥。</p><p>此命令需要从具有受信任 Tailnet Lock 密钥的节点运行。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> revoke-keys</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">tlpub:key1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tlpub:key2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ..</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [flags]</span></span></code></pre></div><p>可用标志：</p><ul><li><code>--cosign=false</code> 使用此设备上的 Tailnet Lock 密钥和来自另一个具有受信任 Tailnet Lock 密钥且已运行 <code>tailscale lock revoke-keys</code> 的设备的提供的恢复命令，继续密钥撤销。</li><li><code>--finish=false</code> 通过传输撤销来完成恢复过程。</li><li><code>--fork-from &lt;hash&gt;</code>（仅限高级用户）要从中重写 tailnet 密钥授权机构状态的父 <a href="https://tailscale.com/kb/1230/tailnet-lock-whitepaper#authority-update-messages-aums" target="_blank" rel="noreferrer">授权更新消息</a>（AUM）的哈希值。</li></ul><p>指定的 Tailnet Lock 密钥是 Tailnet Lock 公钥。您可以通过在该节点上运行 <code>tailscale lock</code> 然后复制该节点的 Tailnet Lock 密钥来识别 Tailnet Lock 密钥。</p><p>附加密钥列表必须用空格分隔。</p><blockquote><p><strong>注意</strong>：如果您想移除未受损的密钥，请改用 <a href="#lock-remove"><code>tailscale lock remove</code></a> 命令。</p></blockquote><p>撤销是一个多步骤过程，需要多个签名节点共同签署撤销。每个步骤都使用 <code>tailscale lock revoke-keys</code> 命令。</p><ol><li><p>在没有受损密钥的签名节点上打开终端。</p></li><li><p>运行以下命令，其中 <code>&lt;tlpub:compromised-key1 tlpub:compromised-key2&gt;</code> 是您要撤销的密钥的空格分隔列表：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> revoke-keys</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tlpub:compromised-key1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tlpub:compromised-key2</span></span></code></pre></div><p>此命令的输出包含一个 <code>tailscale lock revoke-keys --cosign</code> 命令，您将在下一步中使用。</p></li><li><p>在另一个受信任的签名节点上，运行 <code>tailscale lock revoke-keys --cosign</code> 命令。此命令的输出包含一个新的 <code>tailscale lock revoke-keys --cosign</code> 命令。重复此过程，始终使用每个 <code>--cosign</code> 命令的新输出，直到您使用 <code>--cosign</code> 的次数超过撤销密钥的数量。例如，如果您撤销了 3 个密钥，则需要运行 <code>tailscale lock revoke-keys --cosign</code> 命令 4 次。</p></li><li><p>通过运行从最后一次使用 <code>--cosign</code> 输出的命令来完成过程，<strong>但</strong>将 <code>--cosign</code> 替换为 <code>--finish</code>：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> revoke-keys</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --finish</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hex-dat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div></li></ol><p>默认情况下，Tailscale 将确定在 Tailnet Lock 日志中分叉的适当点。如果同意应撤销密钥的签名节点多于不同意的签名节点，则 Tailscale 确定的分叉中仍受信任的密钥将用于代替已撤销的密钥。</p><p>如果大多数签名节点受损，您可以 <a href="https://tailscale.com/kb/1226/tailnet-lock#disable-tailnet-lock" target="_blank" rel="noreferrer">禁用</a> 然后 <a href="https://tailscale.com/kb/1226/tailnet-lock#enable-tailnet-lock" target="_blank" rel="noreferrer">重新启用</a> Tailnet Lock 本身。</p><hr><h1 id="tailscale-serve-command" tabindex="-1"><a href="https://tailscale.com/kb/1242/tailscale-serve" target="_blank" rel="noreferrer">tailscale serve command</a> <a class="header-anchor" href="#tailscale-serve-command" aria-label="Permalink to “tailscale serve command”">​</a></h1><blockquote><p><strong>注意</strong>：Tailscale Funnel 和 Tailscale Serve 的 CLI 命令在 Tailscale 客户端 1.52 版本中已更改。如果您在之前的版本中使用过 Funnel 或 Serve，建议查看 CLI 文档。</p></blockquote><p><code>tailscale serve</code> 让您可以在 Tailscale 网络（称为 tailnet）内安全地共享本地服务。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [flags] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">target</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>您也可以选择使用 <a href="https://tailscale.com/kb/1223/funnel" target="_blank" rel="noreferrer">Tailscale Funnel</a> 配合 <a href="https://tailscale.com/kb/1311/tailscale-funnel" target="_blank" rel="noreferrer"><code>tailscale funnel</code></a> 命令将您的服务公开暴露给整个互联网。</p><p>子命令：</p><ul><li><a href="#get-the-status"><code>status</code></a> 获取状态</li><li><a href="#reset-tailscale-serve"><code>reset</code></a> 重置配置</li><li><a href="#drain"><code>drain</code></a> 排空 <a href="https://tailscale.com/kb/1552/tailscale-services" target="_blank" rel="noreferrer">服务</a></li><li><a href="#advertise"><code>advertise</code></a> 宣告 <a href="https://tailscale.com/kb/1552/tailscale-services" target="_blank" rel="noreferrer">服务</a></li><li><a href="#get-service-config"><code>get-config</code></a> 获取 <a href="https://tailscale.com/kb/1552/tailscale-services" target="_blank" rel="noreferrer">服务</a> 配置</li><li><a href="#set-service-config"><code>set-config</code></a> 设置 <a href="https://tailscale.com/kb/1552/tailscale-services" target="_blank" rel="noreferrer">服务</a> 配置</li></ul><p>有关各种用例和示例，请参阅 <a href="https://tailscale.com/kb/1313/serve-examples" target="_blank" rel="noreferrer">Tailscale Serve 示例</a>。</p><h2 id="serve-命令标志" tabindex="-1">Serve 命令标志 <a class="header-anchor" href="#serve-命令标志" aria-label="Permalink to “Serve 命令标志”">​</a></h2><p>可用标志：</p><ul><li><code>--accept-app-caps=&lt;capability-1,capability-2,...&gt;</code> 要转发给服务器的 <a href="https://tailscale.com/kb/1537/grants-app-capabilities" target="_blank" rel="noreferrer">应用能力</a>（使用逗号分隔列表指定多个能力）。</li><li><code>--bg</code> 确定命令是否应作为后台进程运行。</li><li><code>--http=&lt;port&gt;</code> 在指定端口暴露 HTTP 服务器。</li><li><code>--https=&lt;port&gt;</code> 在指定端口暴露 HTTPS 服务器（默认）。</li><li><code>--proxy-protocol=&lt;version&gt;</code> 用于 TCP 转发的 PROXY 协议版本（1 或 2）。</li><li><code>--service=&lt;virtual-ip&gt;</code> 为具有不同虚拟 IP 的 <a href="https://tailscale.com/kb/1552/tailscale-services" target="_blank" rel="noreferrer">Tailscale 服务</a> 提供服务，而不是设备的 IP 地址。</li><li><code>--set-path=&lt;path&gt;</code> 将指定路径附加到访问底层服务的基础 URL。</li><li><code>--tcp=&lt;port&gt;</code> 在指定端口暴露 TCP 转发器以转发 TCP 数据包。</li><li><code>--tls-terminated-tcp=&lt;port&gt;</code> 在指定端口暴露 TLS 终止的 TCP 转发器以转发 TCP 数据包。</li><li><code>--tun</code> 将 <a href="https://tailscale.com/kb/1552/tailscale-services#layer-3-endpoints-network-layer" target="_blank" rel="noreferrer">第 3 层服务</a> 配置为将所有流量转发到本地机器（默认为 false）；仅支持服务。</li><li><code>--yes</code> 无需交互式提示即可更新。</li></ul><p><code>tailscale serve</code> 命令接受一个目标，该目标可以是文件、目录、文本，或最常见的是本地设备上运行的服务的位置。您可以将本地服务的位置写为端口号（例如 <code>3000</code>）、部分 URL（例如 <code>localhost:3000</code>）或包含路径的完整 URL（例如 <code>tcp://localhost:3000/foo</code>、<code>https+insecure://localhost:3000/foo</code>）。</p><h2 id="使用-https-和-http-服务器-1" tabindex="-1">使用 HTTPS 和 HTTP 服务器 <a class="header-anchor" href="#使用-https-和-http-服务器-1" aria-label="Permalink to “使用 HTTPS 和 HTTP 服务器”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --https=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">targe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [off]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --http=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">targe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [off]</span></span></code></pre></div><p><code>serve</code> 提供 HTTPS 和 HTTP 服务器，有几种模式：反向代理、文件服务器和静态文本服务器。HTTPS 流量使用自动配置的 TLS 证书。默认情况下，设备的 Tailscale 守护进程终止 HTTPS 连接。</p><ul><li><p><code>--https=&lt;port&gt;</code> 或 <code>http=&lt;port&gt;</code> 指定要监听的端口</p></li><li><p><code>--set-path</code> 是一个斜杠分隔的 URL 路径。根级挂载点将是 <code>/</code>，并且将通过向 <code>https://my-node.example.ts.net/</code> 发出请求来匹配。有关这些路径模式如何匹配的更多信息，请参阅 Go <a href="https://pkg.go.dev/net/http#ServeMux" target="_blank" rel="noreferrer">ServeMux</a> 文档。我们的挂载点行为类似。</p></li><li><p><code>&lt;target&gt;</code> Serve 提供 4 个内容服务选项：HTTP 反向代理、文件、目录和静态文本。反向代理允许您将请求转发到本地 HTTP Web 服务器。提供本地文件路径可以提供服务文件或文件目录的能力。静态文本服务主要用于调试目的，并提供静态响应。</p><ul><li><p><strong>反向代理</strong></p><p>要作为本地后端的反向代理，请提供 <code>&lt;target&gt;</code> 参数的位置。您可以将本地服务的位置写为端口号（例如 <code>3000</code>）、部分 URL（例如 <code>localhost:3000</code>）或包含路径的完整 URL（例如 <code>tcp://localhost:3000/foo</code>、<code>https+insecure://localhost:3000/foo</code>）。请注意，只有 <code>http://127.0.0.1</code> 支持代理。</p><p>示例：<code>tailscale serve localhost:3000</code></p><p>或者，通过 HTTP 提供服务：</p><p>示例：<code>tailscale serve --http=80 localhost:3000</code></p><p>HTTP 服务器可以使用简短的 MagicDNS 名称访问，如 <code>http://my-node</code></p></li><li><p><strong>文件服务器</strong></p><p>提供您希望服务的文件或文件目录的完整绝对路径。如果您指定目录，这将呈现一个包含指向文件和子目录链接的目录列表。</p><p>示例：<code>tailscale serve /home/alice/blog/index.html</code></p><p>由于 macOS 应用沙盒限制，此选项仅在使用 Tailscale 的<a href="https://tailscale.com/kb/1065/macos-variants" target="_blank" rel="noreferrer">开源版本</a>时有效。如果您通过 Mac App Store 或作为独立版本系统扩展在 macOS 上安装了 Tailscale，您可以使用 Serve 共享端口，但不能共享文件或目录。</p></li><li><p><strong>静态文本服务器</strong></p><p>将 <code>text:&lt;value&gt;</code> 指定为 <code>&lt;target&gt;</code> 会配置一个静态纯文本服务器。</p><p>示例：<code>tailscale serve text:&quot;Hello, world!&quot;</code></p></li></ul></li></ul><h2 id="使用-proxy-协议-1" tabindex="-1">使用 PROXY 协议 <a class="header-anchor" href="#使用-proxy-协议-1" aria-label="Permalink to “使用 PROXY 协议”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --proxy-protocol=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">targe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><blockquote><p><strong>注意</strong>：对于大多数情况，用户可能会使用版本 <code>2</code>。</p></blockquote><p><a href="https://www.haproxy.com/blog/use-the-proxy-protocol-to-preserve-a-clients-ip-address" target="_blank" rel="noreferrer">PROXY 协议</a>是一种最小的网络协议，用于保留有关代理连接的信息（通常是源 IP 地址），通过代理或负载均衡器传递到后端目标。这使您使用 Serve 公开的服务能够确定连接客户端的原始 IP 地址和端口。</p><p>例如：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --proxy-protocol=2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tls-terminated-tcp=443</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp://127.0.0.1:9899</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Available</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> within</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tailnet:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp://serve-test.example.ts.net:443</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (TLS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">terminated,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PROXY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> protocol</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp://100.101.102.103:443</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp://[fd7a:115c:a1e0::1111:2222]:443</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">tcp://127.0.0.1:9899</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Press</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Ctrl+C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exit.</span></span></code></pre></div><p>后端（运行在 <code>localhost:9899</code>）然后通过 PROXY 协议获取原始源 IP 和端口。</p><h2 id="使用-tcp-转发器-1" tabindex="-1">使用 TCP 转发器 <a class="header-anchor" href="#使用-tcp-转发器-1" aria-label="Permalink to “使用 TCP 转发器”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tcp=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp://localhost:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">local-por</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [off]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tls-terminated-tcp=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp://localhost:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">local-por</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [off]</span></span></code></pre></div><p><code>serve</code> 命令提供一个 TCP 转发器，您可以使用它将原始 TCP 数据包和 TLS 终止的 TCP 数据包转发到本地 TCP 服务器，如 Caddy 或其他基于 TCP 的协议，如 SSH 或 RDP。默认情况下，TCP 转发器转发原始数据包。</p><ul><li><p><code>--tcp=&lt;port&gt;</code> 在指定端口设置原始 TCP 转发器。您可以使用任何有效的端口号。</p></li><li><p><code>--tls-terminated-tcp=&lt;port&gt;</code> 在指定端口设置 TLS 终止的 TCP 转发器。您可以使用任何有效的端口号。</p></li><li><p><code>tcp://localhost:&lt;local-port&gt;</code> 指定要转发数据包的本地端口。</p></li></ul><h2 id="使用有效证书-1" tabindex="-1">使用有效证书 <a class="header-anchor" href="#使用有效证书-1" aria-label="Permalink to “使用有效证书”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https:targe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>如果您有有效证书，请在 <code>&lt;target&gt;</code> 参数中使用 <code>https</code>。</p><p>示例：<code>tailscale serve https://localhost:8443</code></p><h2 id="忽略无效和自签名证书检查-1" tabindex="-1">忽略无效和自签名证书检查 <a class="header-anchor" href="#忽略无效和自签名证书检查-1" aria-label="Permalink to “忽略无效和自签名证书检查”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https+insecure:targe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>如果您使用自签名或其他无效证书运行本地 HTTPS Web 服务器，您可以为 <code>tailscale serve</code> 命令指定 <code>https+insecure</code> 作为特殊的伪协议。</p><p>示例：<code>tailscale serve https+insecure://localhost:8443</code></p><h2 id="获取状态-1" tabindex="-1">获取状态 <a class="header-anchor" href="#获取状态-1" aria-label="Permalink to “获取状态”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [--json]</span></span></code></pre></div><p>要获取服务器的状态，您可以使用 <code>status</code> 子命令。这将列出当前在您的设备上运行的所有服务器。</p><ul><li><p><code>--json</code> 如果您希望以 JSON 格式获取状态，可以提供 <code>--json</code> 参数。</p><p>示例：<code>tailscale serve status --json</code></p></li></ul><h2 id="重置-tailscale-serve" tabindex="-1">重置 Tailscale Serve <a class="header-anchor" href="#重置-tailscale-serve" aria-label="Permalink to “重置 Tailscale Serve”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span></span></code></pre></div><p>要清除当前的 <code>tailscale serve</code> 配置，请使用 <code>reset</code> 子命令。</p><h2 id="禁用-tailscale-serve" tabindex="-1">禁用 Tailscale Serve <a class="header-anchor" href="#禁用-tailscale-serve" aria-label="Permalink to “禁用 Tailscale Serve”">​</a></h2><ul><li><code>[off]</code> 要关闭 <code>tailscale serve</code> 命令，您可以在用于打开它的命令末尾添加 <code>off</code>。这将从活动服务器列表中删除服务器。在 <code>off</code> 命令中，<code>&lt;target&gt;</code> 参数是可选的，但所有原始标志都是必需的。</li></ul><p>如果此命令打开了服务器：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --https=443</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/alice/blog/index.html</span></span></code></pre></div><p>您可以通过运行以下命令将其关闭：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --https=443</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/alice/blog/index.html</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> off</span></span></code></pre></div><p>您可以省略 <code>&lt;target&gt;</code> 参数，因此这两个命令是等效的：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --https=443</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set-path=/foo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/alice/blog/index.html</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> off</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --https=443</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set-path=/foo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> off</span></span></code></pre></div><h2 id="获取服务配置" tabindex="-1">获取服务配置 <a class="header-anchor" href="#获取服务配置" aria-label="Permalink to “获取服务配置”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get-config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">fil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [flags]</span></span></code></pre></div><p>获取此节点当前托管的<a href="https://tailscale.com/kb/1552/tailscale-services" target="_blank" rel="noreferrer">服务</a>的配置，格式可以稍后提供给 <code>set-config</code>。这可用于声明服务主机的配置。</p><p>可用标志：</p><ul><li><code>--all</code> 从所有服务读取配置。</li><li><code>--service=&lt;name&gt;</code> 从特定服务读取配置。</li></ul><h2 id="设置服务配置" tabindex="-1">设置服务配置 <a class="header-anchor" href="#设置服务配置" aria-label="Permalink to “设置服务配置”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">fil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [flags]</span></span></code></pre></div><p>读取提供的<a href="https://tailscale.com/kb/1589/tailscale-services-configuration-file" target="_blank" rel="noreferrer">配置文件</a>，并使用它为单个<a href="https://tailscale.com/kb/1552/tailscale-services" target="_blank" rel="noreferrer">服务</a>或此节点托管的所有服务声明配置。</p><ul><li><code>--all</code> 将配置应用于所有服务。</li><li><code>--service=&lt;name&gt;</code> 将配置应用于特定服务。</li></ul><h2 id="排空" tabindex="-1">排空 <a class="header-anchor" href="#排空" aria-label="Permalink to “排空”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> drain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">servic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>从当前节点排空<a href="https://tailscale.com/kb/1552/tailscale-services" target="_blank" rel="noreferrer">服务</a>。</p><p>使用此命令可以优雅地从当前节点移除服务，而不会中断现有连接。不会接受新连接，但现有连接将继续工作直到关闭。</p><p><code>&lt;service&gt;</code> 应该是服务名称。例如：<code>svc:my-service</code>。</p><h2 id="宣告" tabindex="-1">宣告 <a class="header-anchor" href="#宣告" aria-label="Permalink to “宣告”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> advertise</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">servic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>将此节点宣告为 tailnet 的<a href="https://tailscale.com/kb/1552/tailscale-services" target="_blank" rel="noreferrer">服务</a>主机。</p><p>此命令可用于在<a href="#drain">排空</a>后将服务主机重新上线。如果您使用 <code>tailscale serve</code> 初始化服务，则不需要此操作。</p><p><code>&lt;service&gt;</code> 应该是服务名称。例如：<code>svc:my-service</code>。</p><p>可用标志：</p><ul><li><code>--service=&lt;name&gt;</code> 将配置应用于特定服务。</li></ul><h2 id="重启和重新启动的影响-1" tabindex="-1">重启和重新启动的影响 <a class="header-anchor" href="#重启和重新启动的影响-1" aria-label="Permalink to “重启和重新启动的影响”">​</a></h2><p>如果您使用 <a href="#serve-command-flags"><code>-bg</code></a> 标志运行 <code>tailscale serve</code> 命令，它将在后台持续运行，直到您<a href="#disable-tailscale-serve">禁用</a>它。当您重新启动设备或使用 <a href="https://tailscale.com/kb/1080/cli#down" target="_blank" rel="noreferrer"><code>tailscale down</code></a> 和 <a href="https://tailscale.com/kb/1080/cli#up" target="_blank" rel="noreferrer"><code>tailscale up</code></a> 从命令行重新启动 Tailscale 时，Serve 将自动恢复共享。</p><p>如果您不使用 <code>-bg</code> 标志运行 <code>tailscale serve</code> 命令，然后重新启动设备或从命令行重新启动 Tailscale，您必须手动重新启动 Serve 以恢复共享。</p><blockquote><p><strong>注意</strong>：当您将 <code>tailscale serve</code> 命令与 <a href="https://tailscale.com/kb/1552/tailscale-services" target="_blank" rel="noreferrer">Tailscale 服务</a>一起使用时，它默认在后台运行。</p></blockquote><hr><h1 id="tailscale-up-command" tabindex="-1"><a href="https://tailscale.com/kb/1241/tailscale-up" target="_blank" rel="noreferrer">tailscale up command</a> <a class="header-anchor" href="#tailscale-up-command" aria-label="Permalink to “tailscale up command”">​</a></h1><p><code>tailscale up</code> 将您的设备连接到 Tailscale，并在需要时进行身份验证。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [flags]</span></span></code></pre></div><p>不带任何标志运行 <code>tailscale up</code> 即可连接到 Tailscale。</p><p>您可以指定标志来配置 Tailscale 的行为。标志不会在运行之间持久化；每次都必须指定所有标志。</p><p>要清除先前设置的标志（如标签和路由），请使用空参数传递该标志：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用 \`tag:server\` 连接</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --advertise-tags=tag:server</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 连接并清除所有标签</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tailscale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --advertise-tags=</span></span></code></pre></div><p>在 Tailscale v1.8 或更高版本中，如果您忘记指定之前添加的标志，CLI 会发出警告并提供包含所有现有标志的可复制命令。</p><p>可用标志：</p><ul><li><code>--accept-dns</code> 接受来自管理控制台的 <a href="https://tailscale.com/kb/1054/dns" target="_blank" rel="noreferrer">DNS 配置</a>。默认为接受 DNS 设置。</li><li><code>--accept-risk=&lt;risk&gt;</code> 接受风险并跳过风险类型的确认。可以是 <code>lose-ssh</code> 或 <code>all</code>，或空字符串表示不接受风险。</li><li><code>--accept-routes</code> 接受其他节点通告的 <a href="https://tailscale.com/kb/1019/subnets" target="_blank" rel="noreferrer">子网路由</a>。默认值取决于主机操作系统。对于某些平台——Windows、iOS、Android、macOS App Store 版本和 macOS 独立版本——默认是接受路由。所有其他平台默认不接受路由。</li><li><code>--advertise-connector</code> 将此节点通告为 <a href="https://tailscale.com/kb/1281/app-connectors" target="_blank" rel="noreferrer">应用连接器</a>。</li><li><code>--advertise-exit-node</code> 提供作为 Tailscale 网络出站互联网流量的 <a href="https://tailscale.com/kb/1103/exit-nodes" target="_blank" rel="noreferrer">出口节点</a>。默认为不提供作为出口节点。</li><li><code>--advertise-routes=&lt;ip&gt;</code> 向您的整个 Tailscale 网络公开物理 <a href="https://tailscale.com/kb/1019/subnets" target="_blank" rel="noreferrer">子网路由</a>。</li><li><code>--advertise-tags=&lt;tags&gt;</code> 为此设备提供标记权限。您必须 <a href="https://tailscale.com/kb/1337/policy-syntax#tag-owners" target="_blank" rel="noreferrer">在 <code>&quot;TagOwners&quot;</code> 中列出</a> 才能应用标签。</li><li><code>--auth-key=&lt;key&gt;</code> 提供 <a href="https://tailscale.com/kb/1085/auth-keys" target="_blank" rel="noreferrer">身份验证密钥</a> 以自动将节点验证为您的用户帐户。</li><li><code>--client-id</code> 用于通过 <a href="https://tailscale.com/kb/1581/workload-identity-federation" target="_blank" rel="noreferrer">工作负载身份联合</a> 生成 <a href="https://tailscale.com/kb/1085/auth-keys" target="_blank" rel="noreferrer">身份验证密钥</a> 的客户端 ID。</li><li><code>--client-secret</code> 用于生成 <a href="https://tailscale.com/kb/1085/auth-keys" target="_blank" rel="noreferrer">身份验证密钥</a> 的 <a href="https://tailscale.com/kb/1215/oauth-clients" target="_blank" rel="noreferrer">OAuth 客户端</a> 密钥；如果以 <code>file:</code> 开头，则是包含密钥的文件路径。</li><li><code>--exit-node=&lt;ip|name&gt;</code> 提供要用作出口节点的 <a href="https://tailscale.com/kb/1033/ip-and-dns-addresses" target="_blank" rel="noreferrer">Tailscale IP</a> 或 <a href="https://tailscale.com/kb/1098/machine-names" target="_blank" rel="noreferrer">机器名称</a>。您还可以使用 <code>--exit-node=auto:any</code> 跟踪建议的出口节点，并在可用出口节点或网络条件变化时自动切换。要禁用出口节点的使用，请使用空参数传递标志 <code>--exit-node=</code>。</li><li><code>--exit-node-allow-lan-access</code> 允许客户端节点在连接到出口节点时访问其自己的 LAN。默认为连接到出口节点时不允许访问。</li><li><code>--force-reauth</code> 强制重新身份验证。</li><li><code>--hostname=&lt;name&gt;</code> 提供用于设备的替代主机名，而不是操作系统提供的主机名。请注意，这将更改 <a href="https://tailscale.com/kb/1081/magicdns" target="_blank" rel="noreferrer">MagicDNS</a> 中使用的机器名称。</li><li><code>--id-token</code> 来自身份提供者的 ID 令牌，用于与控制服务器交换以进行 <a href="https://tailscale.com/kb/1581/workload-identity-federation" target="_blank" rel="noreferrer">工作负载身份联合</a>；如果以 <code>file:</code> 开头，则是包含令牌的文件路径。</li><li><code>--audience</code> 从身份提供者请求 ID 令牌时使用的受众，用于通过 <a href="https://tailscale.com/kb/1581/workload-identity-federation" target="_blank" rel="noreferrer">工作负载身份联合</a> 生成的身份验证密钥。</li><li><code>--json</code> 以 JSON 格式输出。格式可能会更改。</li><li><code>--login-server=&lt;url&gt;</code> 提供控制服务器的基础 URL，而不是 <code>https://controlplane.tailscale.com</code>。如果您使用 <a href="https://tailscale.com/blog/opensource#the-open-source-coordination-server" target="_blank" rel="noreferrer">Headscale</a> 作为控制服务器，请使用您的 Headscale 实例的 URL。</li><li><code>--netfilter-mode</code>（仅限 Linux）用于控制自动防火墙配置程度的高级功能。值可以是 <code>off</code>、<code>nodivert</code> 或 <code>on</code>。默认为 <code>on</code>，但 Synology 默认为 <code>off</code>。将此标志设置为 <code>off</code> 会禁用所有 <code>netfilter</code> 管理。设置为 <code>nodivert</code> 会创建和管理 Tailscale 子链，但将这些链的调用留给管理员。设置为 <code>on</code> 意味着完全管理 Tailscale 的规则。请注意，如果您将 <code>--netfilter-mode</code> 设置为 <code>off</code> 或 <code>nodivert</code>，您有责任为 Tailscale 流量安全地配置防火墙。我们建议将 <code>--netfilter-mode=on</code> 安装的规则作为起点。有关更多信息，请参阅 <a href="https://tailscale.com/kb/1593/netfilter-modes" target="_blank" rel="noreferrer">netfilter 模式</a>。</li><li><code>--operator=&lt;user&gt;</code> 提供除 <code>root</code> 之外的 Unix 用户名来操作 <code>tailscaled</code>。</li><li><code>--qr</code> 为 Web 登录 URL 生成二维码。默认为不显示二维码。</li><li><code>--qr-format=&lt;format&gt;</code> 二维码格式：<code>small</code> 或 <code>large</code>。默认为 <code>small</code>。</li><li><code>--reset</code> 将未指定的设置重置为默认值。</li><li><code>--shields-up</code> <a href="https://tailscale.com/kb/1072/client-preferences" target="_blank" rel="noreferrer">阻止来自 Tailscale 网络上其他设备的传入连接</a>。适用于仅建立出站连接的个人设备。</li><li><code>--snat-subnet-routes</code>（仅限 Linux）对使用 <code>--advertise-routes</code> 通告的本地路由进行源 NAT 流量。默认为对通告的路由进行 NAT 流量源。设置为 false 以禁用子网路由伪装。</li><li><code>--stateful-filtering</code>（仅限 Linux）为子网路由器和出口节点启用有状态过滤。启用后，目标 IP 为其他节点的入站数据包将被丢弃，除非它们是该节点跟踪的出站连接的一部分。默认为禁用。</li><li><code>--ssh</code> 运行 <a href="https://tailscale.com/kb/1193/tailscale-ssh" target="_blank" rel="noreferrer">Tailscale SSH</a> 服务器，根据 tailnet 管理员声明的 <a href="https://tailscale.com/kb/1018/acls" target="_blank" rel="noreferrer">访问策略</a> 或 <a href="https://tailscale.com/kb/1192/acl-samples#allow-all-default-acl" target="_blank" rel="noreferrer">默认策略</a>（如果未定义）允许访问。默认为 false。</li><li><code>--timeout=&lt;duration&gt;</code> 等待 Tailscale 服务初始化的最长时间。<code>duration</code> 可以是 <a href="https://pkg.go.dev/time#ParseDuration" target="_blank" rel="noreferrer">time.ParseDuration()</a> 可解析的任何值。默认为 <code>0s</code>，表示永远阻塞。</li><li><code>--unattended</code>（仅限 Windows）在 <a href="https://tailscale.com/kb/1088/run-unattended" target="_blank" rel="noreferrer">无人值守模式</a> 下运行，即使当前用户注销后 Tailscale 仍继续运行。</li></ul><hr><h1 id="tailscaled-daemon" tabindex="-1"><a href="https://tailscale.com/kb/1278/tailscaled" target="_blank" rel="noreferrer">tailscaled daemon</a> <a class="header-anchor" href="#tailscaled-daemon" aria-label="Permalink to “tailscaled daemon”">​</a></h1><p>在您的设备上运行的 Tailscale 软件分布在多个二进制文件和进程中。</p><h2 id="平台差异" tabindex="-1">平台差异 <a class="header-anchor" href="#平台差异" aria-label="Permalink to “平台差异”">​</a></h2><p>在大多数平台上，<a href="https://tailscale.com/kb/1080/cli" target="_blank" rel="noreferrer">CLI</a> 是一个名为 <code>tailscale</code>（或 <code>tailscale.exe</code>）的二进制文件，而执行所有网络处理的更高权限守护进程称为 <code>tailscaled</code>（或 <code>tailscaled.exe</code>）。注意最后的 <code>d</code> 代表&quot;守护进程（daemon）&quot;。使用 <code>tailscale</code> 命令可访问的大多数 CLI 命令要求守护进程在机器上运行。</p><p>在 macOS 上<a href="https://tailscale.com/kb/1065/macos-variants" target="_blank" rel="noreferrer">有三种运行 Tailscale 的方式</a>。只有第三种非 GUI 方式包含典型的 <code>tailscale</code> 与 <code>tailscaled</code> 分离。两种 GUI 变体将所有组件捆绑到一个二进制文件中，macOS 在不同上下文中加载：GUI、守护进程（App Store 版本命名为 <code>IPNExtension</code>，zip 文件下载版本命名为 <code>io.tailscale.ipn.macsys.network-extension</code>）和 CLI（与 GUI 相同的二进制文件，但从终端运行时会进入 CLI 模式）。两种 macOS GUI 变体的守护进程尽管名称不同，但实际上是相同的。但技术上它们不是 <code>tailscaled</code>（本主题的主题），尽管共享大部分相同的代码。值得注意的是，任何涉及更改 <code>tailscaled</code> 标志的 <code>tailscaled</code> 行为在 macOS GUI 变体上并不总是可用。</p><h2 id="tailscaled-在哪里运行" tabindex="-1">tailscaled 在哪里运行？ <a class="header-anchor" href="#tailscaled-在哪里运行" aria-label="Permalink to “tailscaled 在哪里运行？”">​</a></h2><p>在 Linux 和其他类 Unix 平台上，<code>tailscaled</code> 通常作为 systemd 服务运行，或者作为您的发行版或操作系统的 init 系统运行。</p><p>在 macOS 上，<code>tailscaled</code>（如上所述，不使用 GUI 构建时）作为 <code>launchd</code> 服务运行。</p><p>在 Windows 上，<code>tailscaled</code> 作为名为&quot;Tailscale&quot;的 Windows 服务运行。</p><h2 id="停止和启动-tailscaled" tabindex="-1">停止和启动 tailscaled <a class="header-anchor" href="#停止和启动-tailscaled" aria-label="Permalink to “停止和启动 tailscaled”">​</a></h2><p>您通常不需要手动停止和启动 <code>tailscaled</code> 进程。当您使用 CLI 命令 <code>tailscale down</code> 时，它应该进入空闲状态。但是，如果您正在调试某些内容或更改标志，则说明因平台而异。</p><p>在 systemd 上，您可以运行 <code>sudo systemctl $VERB tailscaled</code>，其中动词是 <code>stop</code>、<code>start</code>、<code>restart</code> 等之一。</p><p>在 Windows 上，您可以运行 <code>net stop Tailscale</code> 或 <code>net start Tailscale</code>，或使用 Windows 服务管理器。</p><h2 id="从-tailscaled-获取日志" tabindex="-1">从 tailscaled 获取日志 <a class="header-anchor" href="#从-tailscaled-获取日志" aria-label="Permalink to “从 tailscaled 获取日志”">​</a></h2><p>连接到守护进程并流式传输其日志的可移植方式是使用 CLI 并运行 <code>tailscale debug daemon-logs</code>。但是，它目前不支持获取任何追溯日志。</p><p>在 systemd 上，您可以使用 <code>journalctl -u tailscaled --since=&quot;1 hour ago&quot;</code>。</p><p>在 Windows 上，请参阅 <code>C:\\ProgramData\\Tailscale\\Logs</code>。</p><p>在 macOS 上，对于 GUI 构建，使用 <code>Console.app</code> 并搜索 <code>Tailscale</code> 或 <code>IPNExtension</code>。</p><h2 id="tailscaled-的标志" tabindex="-1">tailscaled 的标志 <a class="header-anchor" href="#tailscaled-的标志" aria-label="Permalink to “tailscaled 的标志”">​</a></h2><p><code>tailscaled</code> 有许多标志（命令行参数）可以执行各种操作。有些不是稳定的接口，主要用于调试。一些更常用和稳定的标志包括：</p><ul><li><code>--tun=NAME</code> 指定 TUN 设备名称，或 <code>userspace-networking</code> 作为不使用内核支持并在进程内完成所有操作的魔法值。</li><li><code>--port=N</code> 设置用于对等流量的 UDP 监听端口；0 表示自动选择。</li><li><code>--verbose=N</code>，其中 N 默认为 0。值 1 或更高表示越来越详细。</li><li><code>--debug=localhost:8080</code>，运行提供诸如 <code>/debug/pprof</code>、<code>/debug/metrics</code>、<code>/debug/ipn</code> 或 <code>/debug/magicsock</code> 等路径的调试 HTTP 服务器。可通过调试服务器访问的确切细节可能会随时间变化。</li><li><code>--no-logs-no-support</code> 禁用遥测并选择退出需要此类遥测进行调试的任何支持</li></ul><p>要控制状态（包括首选项和密钥）的存储位置和方式，请使用：</p><ul><li><code>--statedir=</code> 用于存储配置、密钥、Taildrop 文件和其他状态的磁盘目录。</li><li><code>--state=</code> 指向 <code>/path/to/file</code>、<code>kube:&lt;secret-name&gt;</code> 以使用 Kubernetes 密钥、<code>arn:aws:ssm:...</code> 将状态存储在 AWS SSM 中，或 <code>mem:</code> 不存储状态并注册为临时节点。默认情况下，如果未提供，状态存储在 <code>&lt;statedir&gt;/tailscaled.state</code> 中。</li><li><code>--encrypt-state</code> 可选地使用 Linux 上的本地 TPM 设备加密状态文件。</li></ul><p>还有两个运行代理的标志：</p><ul><li><code>--socks5-server=[host]:port</code>，运行 SOCK5 服务器，使您的 tailnet 可通过 SOCKS5 访问</li><li><code>--outbound-http-proxy-listen=[host]:port</code>，运行 HTTP 代理服务器，使您的 tailnet 可通过 HTTP 访问。</li></ul><p>SOCK5 和 HTTP 代理可以具有相同的值，在这种情况下，只打开一个端口，但会根据客户端首先说的内容自动改变它所说的协议。</p><p>以下标志执行操作并退出：</p><ul><li><code>--version</code> 打印版本信息并退出</li><li><code>--cleanup</code> 清理先前运行的系统状态</li></ul><h2 id="设置标志" tabindex="-1">设置标志 <a class="header-anchor" href="#设置标志" aria-label="Permalink to “设置标志”">​</a></h2><p>设置 <code>tailscaled</code> 标志因平台而异。</p><p>在 Linux 上，您可以修改 <code>/etc/default/tailscaled</code> 中的 <code>FLAGS</code>，systemd 单元定义将包含这些标志。</p><h2 id="环境变量" tabindex="-1">环境变量 <a class="header-anchor" href="#环境变量" aria-label="Permalink to “环境变量”">​</a></h2><h3 id="windows" tabindex="-1">Windows <a class="header-anchor" href="#windows" aria-label="Permalink to “Windows”">​</a></h3><p>您可以通过执行以下操作在 Windows 上设置一些环境变量：</p><ul><li>在 <code>C:\\ProgramData\\Tailscale</code> 中创建 <code>tailscaled-env.txt</code> 文件。</li><li>在 <code>tailscaled-env.txt</code> 文件中，您可以设置 <code>PORT=N</code>（例如，更改默认 UDP 监听端口）。</li><li>保存文件并运行 <code>net stop Tailscale</code>、<code>net start Tailscale</code> 以应用更改。</li></ul>`,284)])])}const g=i(t,[["render",n]]);export{r as __pageData,g as default};
